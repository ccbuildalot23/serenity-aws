<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Serenity Mental Health Platform - Complete</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    /* Navigation */
    .nav {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .nav-brand {
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
    }
    
    .nav-menu {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    
    .nav-item {
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .nav-item:hover {
      background: #f3f4f6;
    }
    
    .nav-item.active {
      background: #667eea;
      color: white;
    }
    
    /* Main Content */
    .main {
      flex: 1;
      padding: 40px 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 800px;
      width: 100%;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }
    
    .page {
      display: none;
    }
    
    .page.active {
      display: block;
    }
    
    /* Forms */
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #374151;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    button {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      background: #667eea;
      color: white;
    }
    
    button:hover {
      background: #5a67d8;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    button.secondary {
      background: #e5e7eb;
      color: #374151;
    }
    
    button.secondary:hover {
      background: #d1d5db;
    }
    
    button.danger {
      background: #ef4444;
    }
    
    button.danger:hover {
      background: #dc2626;
    }
    
    /* Dashboard */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .metric-card {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }
    
    .metric-value {
      font-size: 32px;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 5px;
    }
    
    .metric-label {
      font-size: 14px;
      color: #6b7280;
    }
    
    /* Check-in Form */
    .mood-scale {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
    }
    
    .mood-option {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid #d1d5db;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .mood-option:hover {
      transform: scale(1.1);
    }
    
    .mood-option.selected {
      border-color: #667eea;
      background: #667eea;
      color: white;
    }
    
    /* Alerts */
    .alert {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .alert.success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #6ee7b7;
    }
    
    .alert.error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fca5a5;
    }
    
    .alert.info {
      background: #dbeafe;
      color: #1e40af;
      border: 1px solid #93c5fd;
    }
    
    /* Crisis Button */
    .crisis-button {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: #ef4444;
      color: white;
      font-size: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 20px rgba(239, 68, 68, 0.4);
      cursor: pointer;
      transition: all 0.3s;
      z-index: 1000;
    }
    
    .crisis-button:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 30px rgba(239, 68, 68, 0.6);
    }
    
    /* Loading */
    .loading {
      text-align: center;
      padding: 40px;
    }
    
    .spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid #e5e7eb;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .container {
        padding: 20px;
      }
      
      .nav {
        flex-direction: column;
        gap: 15px;
      }
    }
  </style>
</head>
<body>
  <div id="app" class="app">
    <!-- Navigation -->
    <nav class="nav">
      <div class="nav-brand">🌟 Serenity Health</div>
      <div class="nav-menu" id="navMenu">
        <!-- Will be populated based on auth state -->
      </div>
    </nav>
    
    <!-- Main Content -->
    <main class="main">
      <div class="container">
        <!-- Login Page -->
        <div id="loginPage" class="page active">
          <h2>Welcome Back</h2>
          <p style="margin: 20px 0; color: #6b7280;">Sign in to continue your wellness journey</p>
          
          <div id="loginAlert"></div>
          
          <form id="loginForm">
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="loginEmail" required placeholder="you@example.com">
            </div>
            
            <div class="form-group">
              <label>Password</label>
              <input type="password" id="loginPassword" required placeholder="••••••••">
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
              <button type="submit">Sign In</button>
              <button type="button" class="secondary" onclick="showPage('register')">Create Account</button>
            </div>
            
            <p style="margin-top: 20px; text-align: center;">
              <a href="#" onclick="showPage('forgot'); return false;" style="color: #667eea;">Forgot password?</a>
            </p>
          </form>
        </div>
        
        <!-- Register Page -->
        <div id="registerPage" class="page">
          <h2>Create Your Account</h2>
          <p style="margin: 20px 0; color: #6b7280;">Join Serenity for better mental health support</p>
          
          <div id="registerAlert"></div>
          
          <form id="registerForm">
            <div class="form-group">
              <label>First Name</label>
              <input type="text" id="regFirstName" required>
            </div>
            
            <div class="form-group">
              <label>Last Name</label>
              <input type="text" id="regLastName" required>
            </div>
            
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="regEmail" required>
            </div>
            
            <div class="form-group">
              <label>Password</label>
              <input type="password" id="regPassword" required minlength="12" 
                     pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{12,}"
                     title="Must contain at least 12 characters, including uppercase, lowercase, number and special character">
            </div>
            
            <div class="form-group">
              <label>Role</label>
              <select id="regRole" required>
                <option value="PATIENT">Patient</option>
                <option value="PROVIDER">Healthcare Provider</option>
                <option value="SUPPORTER">Support Person</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>Phone (Optional)</label>
              <input type="tel" id="regPhone" placeholder="+1234567890">
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
              <button type="submit">Create Account</button>
              <button type="button" class="secondary" onclick="showPage('login')">Back to Login</button>
            </div>
          </form>
        </div>
        
        <!-- Patient Dashboard -->
        <div id="patientDashboard" class="page">
          <h2>Welcome Back, <span id="patientName"></span>!</h2>
          
          <div class="dashboard-grid" style="margin-top: 30px;">
            <div class="metric-card">
              <div class="metric-value">7</div>
              <div class="metric-label">Day Streak</div>
            </div>
            <div class="metric-card">
              <div class="metric-value">85%</div>
              <div class="metric-label">Mood Improvement</div>
            </div>
            <div class="metric-card">
              <div class="metric-value">12</div>
              <div class="metric-label">Check-ins This Month</div>
            </div>
            <div class="metric-card">
              <div class="metric-value">3</div>
              <div class="metric-label">Support Messages</div>
            </div>
          </div>
          
          <h3>Daily Check-in</h3>
          <form id="checkinForm" style="margin-top: 20px;">
            <div class="form-group">
              <label>How are you feeling today? (1-10)</label>
              <div class="mood-scale">
                <div class="mood-option" data-value="1">1</div>
                <div class="mood-option" data-value="2">2</div>
                <div class="mood-option" data-value="3">3</div>
                <div class="mood-option" data-value="4">4</div>
                <div class="mood-option" data-value="5">5</div>
                <div class="mood-option" data-value="6">6</div>
                <div class="mood-option" data-value="7">7</div>
                <div class="mood-option" data-value="8">8</div>
                <div class="mood-option" data-value="9">9</div>
                <div class="mood-option" data-value="10">10</div>
              </div>
            </div>
            
            <div class="form-group">
              <label>Anxiety Level (1-10)</label>
              <input type="range" min="1" max="10" value="5" id="anxietyLevel">
              <span id="anxietyValue">5</span>
            </div>
            
            <div class="form-group">
              <label>Hours of Sleep</label>
              <input type="number" min="0" max="24" step="0.5" id="sleepHours" placeholder="7.5">
            </div>
            
            <div class="form-group">
              <label>Notes (Optional)</label>
              <textarea id="checkinNotes" rows="3" placeholder="How was your day?"></textarea>
            </div>
            
            <button type="submit">Submit Check-in</button>
          </form>
        </div>
        
        <!-- Provider Dashboard -->
        <div id="providerDashboard" class="page">
          <h2>Provider Dashboard</h2>
          
          <div class="dashboard-grid" style="margin-top: 30px;">
            <div class="metric-card">
              <div class="metric-value">42</div>
              <div class="metric-label">Active Patients</div>
            </div>
            <div class="metric-card">
              <div class="metric-value">3</div>
              <div class="metric-label">Crisis Alerts</div>
            </div>
            <div class="metric-card">
              <div class="metric-value">$45k</div>
              <div class="metric-label">Monthly CCM Revenue</div>
            </div>
            <div class="metric-card">
              <div class="metric-value">89%</div>
              <div class="metric-label">Patient Engagement</div>
            </div>
          </div>
          
          <h3>Recent Alerts</h3>
          <div style="margin-top: 20px;">
            <div class="alert info">
              <strong>John D.</strong> - Mood score dropped below threshold (3/10)
            </div>
            <div class="alert info">
              <strong>Sarah M.</strong> - Missed 3 consecutive check-ins
            </div>
            <div class="alert info">
              <strong>Mike R.</strong> - Requested provider contact
            </div>
          </div>
          
          <h3>Quick Actions</h3>
          <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button>View All Patients</button>
            <button class="secondary">Care Plans</button>
            <button class="secondary">Messages</button>
          </div>
        </div>
        
        <!-- Forgot Password Page -->
        <div id="forgotPage" class="page">
          <h2>Reset Password</h2>
          <p style="margin: 20px 0; color: #6b7280;">Enter your email to receive a reset code</p>
          
          <div id="forgotAlert"></div>
          
          <form id="forgotForm">
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="forgotEmail" required>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
              <button type="submit">Send Reset Code</button>
              <button type="button" class="secondary" onclick="showPage('login')">Back to Login</button>
            </div>
          </form>
        </div>
      </div>
    </main>
    
    <!-- Crisis Button -->
    <div class="crisis-button" onclick="triggerCrisis()" title="Crisis Support">
      🚨
    </div>
  </div>
  
  <script>
    // API Configuration
    const API_URL = 'https://hiheb8cthc.execute-api.us-east-1.amazonaws.com/dev';
    
    // State Management
    let currentUser = null;
    let authToken = null;
    
    // Initialize App
    window.onload = () => {
      checkAuth();
      setupEventListeners();
      setupMoodSelector();
    };
    
    // Check Authentication
    function checkAuth() {
      authToken = localStorage.getItem('authToken');
      currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
      
      if (authToken && currentUser) {
        updateNavigation(true);
        if (currentUser.role === 'PROVIDER') {
          showPage('providerDashboard');
        } else {
          showPage('patientDashboard');
          document.getElementById('patientName').textContent = currentUser.firstName || 'User';
        }
      } else {
        updateNavigation(false);
        showPage('login');
      }
    }
    
    // Update Navigation
    function updateNavigation(isLoggedIn) {
      const navMenu = document.getElementById('navMenu');
      
      if (isLoggedIn) {
        navMenu.innerHTML = `
          <div class="nav-item" onclick="showDashboard()">Dashboard</div>
          <div class="nav-item" onclick="showProfile()">Profile</div>
          <div class="nav-item" onclick="logout()">Logout</div>
        `;
      } else {
        navMenu.innerHTML = `
          <div class="nav-item" onclick="showPage('login')">Login</div>
          <div class="nav-item" onclick="showPage('register')">Register</div>
        `;
      }
    }
    
    // Show Page
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });
      
      const page = document.getElementById(pageId + 'Page') || document.getElementById(pageId);
      if (page) {
        page.classList.add('active');
      }
    }
    
    // Show Dashboard
    function showDashboard() {
      if (currentUser?.role === 'PROVIDER') {
        showPage('providerDashboard');
      } else {
        showPage('patientDashboard');
      }
    }
    
    // Show Profile
    function showProfile() {
      alert('Profile page coming soon!');
    }
    
    // Setup Event Listeners
    function setupEventListeners() {
      // Login Form
      document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        await login();
      });
      
      // Register Form
      document.getElementById('registerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        await register();
      });
      
      // Check-in Form
      document.getElementById('checkinForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        await submitCheckin();
      });
      
      // Forgot Password Form
      document.getElementById('forgotForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        await forgotPassword();
      });
      
      // Anxiety Slider
      document.getElementById('anxietyLevel').addEventListener('input', (e) => {
        document.getElementById('anxietyValue').textContent = e.target.value;
      });
    }
    
    // Setup Mood Selector
    function setupMoodSelector() {
      document.querySelectorAll('.mood-option').forEach(option => {
        option.addEventListener('click', () => {
          document.querySelectorAll('.mood-option').forEach(o => o.classList.remove('selected'));
          option.classList.add('selected');
        });
      });
    }
    
    // Login
    async function login() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      try {
        const response = await fetch(`${API_URL}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Store auth data
          authToken = data.tokens.accessToken;
          localStorage.setItem('authToken', authToken);
          
          // Mock user data (would come from /auth/user endpoint)
          currentUser = {
            email,
            firstName: 'John',
            lastName: 'Doe',
            role: email.includes('provider') ? 'PROVIDER' : 'PATIENT'
          };
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          
          showAlert('loginAlert', 'Login successful!', 'success');
          checkAuth();
        } else {
          showAlert('loginAlert', data.error || 'Login failed', 'error');
        }
      } catch (error) {
        showAlert('loginAlert', 'Connection error. Please try again.', 'error');
      }
    }
    
    // Register
    async function register() {
      const data = {
        firstName: document.getElementById('regFirstName').value,
        lastName: document.getElementById('regLastName').value,
        email: document.getElementById('regEmail').value,
        password: document.getElementById('regPassword').value,
        role: document.getElementById('regRole').value,
        phone: document.getElementById('regPhone').value
      };
      
      try {
        const response = await fetch(`${API_URL}/auth/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
          showAlert('registerAlert', 'Registration successful! Please check your email for verification.', 'success');
          setTimeout(() => showPage('login'), 3000);
        } else {
          showAlert('registerAlert', result.error || 'Registration failed', 'error');
        }
      } catch (error) {
        showAlert('registerAlert', 'Connection error. Please try again.', 'error');
      }
    }
    
    // Submit Check-in
    async function submitCheckin() {
      const selectedMood = document.querySelector('.mood-option.selected');
      
      if (!selectedMood) {
        alert('Please select your mood');
        return;
      }
      
      const data = {
        mood: parseInt(selectedMood.dataset.value),
        anxiety: parseInt(document.getElementById('anxietyLevel').value),
        sleepHours: parseFloat(document.getElementById('sleepHours').value) || 0,
        notes: document.getElementById('checkinNotes').value
      };
      
      try {
        const response = await fetch(`${API_URL}/checkin`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert('Check-in submitted successfully!');
          document.getElementById('checkinForm').reset();
          document.querySelectorAll('.mood-option').forEach(o => o.classList.remove('selected'));
        } else {
          alert('Failed to submit check-in');
        }
      } catch (error) {
        alert('Connection error. Please try again.');
      }
    }
    
    // Forgot Password
    async function forgotPassword() {
      const email = document.getElementById('forgotEmail').value;
      
      try {
        const response = await fetch(`${API_URL}/auth/forgot-password`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });
        
        const data = await response.json();
        
        if (data.success) {
          showAlert('forgotAlert', 'Password reset code sent to your email!', 'success');
        } else {
          showAlert('forgotAlert', data.error || 'Failed to send reset code', 'error');
        }
      } catch (error) {
        showAlert('forgotAlert', 'Connection error. Please try again.', 'error');
      }
    }
    
    // Logout
    function logout() {
      localStorage.removeItem('authToken');
      localStorage.removeItem('currentUser');
      authToken = null;
      currentUser = null;
      checkAuth();
    }
    
    // Trigger Crisis
    function triggerCrisis() {
      if (confirm('Are you experiencing a crisis? We can connect you with immediate help.')) {
        alert('Crisis support activated!\n\n📞 Calling 988 (Suicide & Crisis Lifeline)\n💬 Notifying your support network\n🏥 Locating nearest emergency services\n\nHelp is on the way.');
        
        // In production, this would:
        // 1. Send immediate notifications
        // 2. Connect to crisis hotline
        // 3. Alert provider
        // 4. Log incident
      }
    }
    
    // Show Alert
    function showAlert(containerId, message, type) {
      const container = document.getElementById(containerId);
      if (container) {
        container.innerHTML = `<div class="alert ${type}">${message}</div>`;
        setTimeout(() => {
          container.innerHTML = '';
        }, 5000);
      }
    }
  </script>
</body>
</html>